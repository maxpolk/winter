#! /bin/bash

#
# Tests for Winter, run as a top-level file.
#
# This file is part of Winter, a wiki-based computing platform.
# Copyright (C) 2012,2014  Max Polk <maxpolk@gmail.com>
# License located at http://www.gnu.org/licenses/agpl-3.0.html
#

#
# Code from:
# http://stackoverflow.com/questions/59895/can-a-bash-script-tell-what-directory-its-stored-in
#
# To capture return string:   DIR=$(ScriptDirectory)
# To echo to stdout:          ScriptDirectory
#
function ScriptDirectory
{
    local SOURCE="${BASH_SOURCE[0]}"
    local DIR="$( dirname "$SOURCE" )"
    while [ -h "$SOURCE" ]; do 
      SOURCE="$(readlink "$SOURCE")"
      [[ $SOURCE != /* ]] && SOURCE="$DIR/$SOURCE"
      DIR="$( cd -P "$( dirname "$SOURCE"  )" && pwd )"
    done
    DIR="$( cd -P "$( dirname "$SOURCE" )" && pwd )"

    echo $DIR
}

function Fail
{
    echo "$@"
    exit 1
}

DIR=$(ScriptDirectory)
cd "$DIR/.." || Fail "Unable to change directory $DIR/.."

# Generic Python version, probably 2
PY=$(hash python 2>/dev/null && hash -t python | head -1)
if [ -z "$PY" ]; then
    echo "Missing Python"
    exit 1
else
    PY_VERSION=$($PY --version 2>&1)
    echo "===================="
    echo "$PY_VERSION"
    echo "===================="
    $PY -m winter.test.tests -v
fi
